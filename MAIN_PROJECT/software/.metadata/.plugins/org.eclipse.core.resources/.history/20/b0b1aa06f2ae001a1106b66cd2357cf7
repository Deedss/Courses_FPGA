#include "sys/alt_stdio.h"
#include "system.h"
#include "altera_avalon_pio_regs.h"
#include "stdio.h"

uint R, G, B;
int SWITCHES;

void redFilter(uint *G, uint *B){
	*G = 0;
	*B = 0;
	return;
}

void greenFilter(uint *R, uint *B){
	*R = 0;
	*B = 0;
	return;
}

void blueFilter(uint *R, uint *G){
	*R = 0;
	*G = 0;
	return;
}

void grayScale(uint *R, uint *G, uint *B){
	/**
	 * GRAYSCALE is calculated by forming a weighted sum of the Red, Green, and Blue colour and dividing it by 3
	 * This value then replaces the old RGB value;	 *
	 */
	*R = *G = *B = ((*R + *G + *B) / 3);
	return;
}

int main()
{
  alt_putstr("Hello from Nios II!\n");

  /* Event loop never exits. */
  while (1)
  {
	R = IORD_ALTERA_AVALON_PIO_DATA(RED_BASE);
	G = IORD_ALTERA_AVALON_PIO_DATA(GREEN_BASE);
	B = IORD_ALTERA_AVALON_PIO_DATA(BLUE_BASE);
	SWITCHES = IORD_ALTERA_AVALON_PIO_DATA(SW_BASE);

	if(R >= 0 && G >= 0 && B >= 0){
		if (SWITCHES == 1){
			redFilter(&G, &B);
		}
		else if (SWITCHES == 2){
			greenFilter(&R, &B);
		}
		else if (SWITCHES == 4){
			blueFilter(&R, &G);
		}
		else if (SWITCHES == 8){
			grayScale(&R, &G, &B);
		}
		IOWR_ALTERA_AVALON_PIO_DATA(RED_BASE, R);
		IOWR_ALTERA_AVALON_PIO_DATA(GREEN_BASE, G);
		IOWR_ALTERA_AVALON_PIO_DATA(BLUE_BASE, B);
		IOWR_ALTERA_AVALON_PIO_DATA(SW_BASE, SWITCHES);
	}
  }
  return 0;
}
